<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
        <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Adding Maven dependencies to Arquillian test | cassiomolin</title>
<meta name="generator" content="Jekyll v3.6.3" />
<meta property="og:title" content="Adding Maven dependencies to Arquillian test" />
<meta name="author" content="Cassio Mazzochi Molin" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Using ShrinkWrap resolvers to add Maven dependencies to Arquillian tests." />
<meta property="og:description" content="Using ShrinkWrap resolvers to add Maven dependencies to Arquillian tests." />
<link rel="canonical" href="http://localhost:4000/2015/06/07/adding-maven-dependencies-to-arquillian-test/" />
<meta property="og:url" content="http://localhost:4000/2015/06/07/adding-maven-dependencies-to-arquillian-test/" />
<meta property="og:site_name" content="cassiomolin" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-06-07T15:57:56+01:00" />
<script type="application/ld+json">
{"url":"http://localhost:4000/2015/06/07/adding-maven-dependencies-to-arquillian-test/","headline":"Adding Maven dependencies to Arquillian test","dateModified":"2015-06-07T15:57:56+01:00","datePublished":"2015-06-07T15:57:56+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2015/06/07/adding-maven-dependencies-to-arquillian-test/"},"author":{"@type":"Person","name":"Cassio Mazzochi Molin"},"description":"Using ShrinkWrap resolvers to add Maven dependencies to Arquillian tests.","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    

    <!-- Site Favicon -->
    <link rel="shortcut icon" href="http://localhost:4000/assets/images/favicon.ico" type="image/png" />

    <!-- Font Embed Code -->
    <link href="https://fonts.googleapis.com/css?family=Karla:400,400i,700,700i" rel="stylesheet" />

    <!-- CSS Styles -->
    <link href="/assets/css/style.css" rel="stylesheet">

</head>



<body class="layout-post">
    <div id="page" class="site">

        
        <header id="masthead" class="site-header outer">
    <div class="site-header-inside">
        <div class="site-branding">
            
                <h1 class="site-title"><a href="/" rel="home">cassiomolin</a></h1>
            
        </div><!-- .site-branding -->
        <nav id="main-navigation" class="site-navigation" aria-label="Primary Navigation">
            <ul class="menu">
            
                <li class="menu-item"><a href="/about/">About</a></li>
            
                <li class="menu-item"><a href="/contact/">Contact Me</a></li>
            
            </ul>
            <button id="sidebar-show" class="sidebar-toggle"><span class="screen-reader-text">Open Sidebar</span><span class="icon-more" aria-hidden="true"></span></button>
        </nav><!-- .site-navigation -->
    </div><!-- .site-header-inside -->
</header><!-- .site-header -->
        

        <div id="content" class="site-content fadeInDown delay_075s">
    <main id="main" class="site-main outer">
        <article class="post-full inner">
            <header class="post-header">
                <div class="post-meta">
                    <time class="post-date" datetime="2015-06-07">June 7,
                        2015</time>
                </div><!-- .post-meta -->
                <h1 class="posttitle">Adding Maven dependencies to Arquillian test</h1>
            </header><!-- .post-header -->
            
            <div class="post-content">
                <p>By default, Arquillian won’t pack the Maven dependencies into the micro deployment files.</p>

<p>If the classes your are testing depend on external dependencies managed by Maven, follow the steps described below to ensure the Maven dependencies will be packed into the Arquillian micro deployments, avoiding <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/ClassNotFoundException.html"><code class="highlighter-rouge">ClassNotFoundException</code></a>s:</p>

<h2 id="adding-arquillian-dependencies">Adding Arquillian dependencies</h2>

<p>Add Arquillian dependencies to your <code class="highlighter-rouge">pom.xml</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencyManagement&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.jboss.arquillian<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>arquillian-bom<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.1.8.Final<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/dependencyManagement&gt;</span>
</code></pre></div></div>

<p>Add the ShrinkWrap resolver (Maven implementation) to your <code class="highlighter-rouge">pom.xml</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.jboss.shrinkwrap.resolver<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>shrinkwrap-resolver-impl-maven<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>If you are using JUnit, add the Arquillian JUnit container to your <code class="highlighter-rouge">pom.xml</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.jboss.arquillian.junit<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>arquillian-junit-container<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h2 id="importing-maven-dependencies">Importing Maven dependencies</h2>

<p>In your test class, within the method annotated with <code class="highlighter-rouge">@Deployment</code>, import the runtime dependencies with the following line:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">File</span><span class="o">[]</span> <span class="n">files</span> <span class="o">=</span> <span class="n">Maven</span><span class="o">.</span><span class="na">resolver</span><span class="o">().</span><span class="na">loadPomFromFile</span><span class="o">(</span><span class="s">"pom.xml"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">importRuntimeDependencies</span><span class="o">().</span><span class="na">resolve</span><span class="o">().</span><span class="na">withTransitivity</span><span class="o">().</span><span class="na">asFile</span><span class="o">();</span>
</code></pre></div></div>

<p>And then add the dependencies to your deploy using the <code class="highlighter-rouge">addAsLibraries(files)</code> method:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ShrinkWrap</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">WebArchive</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
          <span class="o">.</span><span class="na">addClass</span><span class="o">(</span><span class="n">MyClass1</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
          <span class="o">.</span><span class="na">addClass</span><span class="o">(</span><span class="n">MyClass2</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
          <span class="o">.</span><span class="na">addClass</span><span class="o">(</span><span class="n">MyClass3</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
          <span class="o">.</span><span class="na">addAsLibraries</span><span class="o">(</span><span class="n">files</span><span class="o">);</span>
</code></pre></div></div>

<p>This is how your test class will look like if you are using JUnit:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.jboss.arquillian.container.test.api.Deployment</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jboss.arquillian.junit.Arquillian</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jboss.shrinkwrap.api.ShrinkWrap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jboss.shrinkwrap.api.asset.EmptyAsset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jboss.shrinkwrap.api.spec.WebArchive</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jboss.shrinkwrap.resolver.api.maven.Maven</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.*;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="n">Arquillian</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyTestClassWithMavenDependencies</span> <span class="o">{</span>

    <span class="nd">@Deployment</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">WebArchive</span> <span class="nf">createDeployment</span><span class="o">()</span> <span class="o">{</span>

        <span class="c1">// Import Maven runtime dependencies</span>
        <span class="n">File</span><span class="o">[]</span> <span class="n">files</span> <span class="o">=</span> <span class="n">Maven</span><span class="o">.</span><span class="na">resolver</span><span class="o">().</span><span class="na">loadPomFromFile</span><span class="o">(</span><span class="s">"pom.xml"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">importRuntimeDependencies</span><span class="o">().</span><span class="na">resolve</span><span class="o">().</span><span class="na">withTransitivity</span><span class="o">().</span><span class="na">asFile</span><span class="o">();</span>

        <span class="c1">// Create deploy file</span>
        <span class="n">WebArchive</span> <span class="n">war</span> <span class="o">=</span> <span class="n">ShrinkWrap</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">WebArchive</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addClass</span><span class="o">(</span><span class="n">MyClass1</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addClass</span><span class="o">(</span><span class="n">MyClass2</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addClass</span><span class="o">(</span><span class="n">MyClass3</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addAsLibraries</span><span class="o">(</span><span class="n">files</span><span class="o">);</span>

        <span class="c1">// Show the deploy structure</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">war</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="kc">true</span><span class="o">));</span>

        <span class="k">return</span> <span class="n">war</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Create your tests here</span>
<span class="o">}</span>
</code></pre></div></div>

<hr />

<p><strong>Note 1:</strong> The above solution was tested with Arquillian <code class="highlighter-rouge">1.1.8.Final</code>. Check the most recent version of Arquillian artifacts on the <a href="http://arquillian.org/modules/core-platform/#artifacts">documentation</a>.</p>

<p><strong>Note 2:</strong> For more details on how to resolve dependencies, have a look at the <a href="https://github.com/shrinkwrap/resolver#resolving-dependencies">ShrinkWrap Resolvers documentation</a>.</p>


            </div>
            <footer class="post-footer">
                
                <p class="post-tags">
                     
                    <a href='/tag/java/'>java</a>
                    
                     
                    <a href='/tag/test/'>test</a>
                    
                     
                    <a href='/tag/arquillian/'>arquillian</a>
                    
                    
                </p>
                
                <div class="post-share">
                    <span class="post-share-title">Share:</span>
                    <a target="_blank" href="https://twitter.com/share?text=Adding+Maven+dependencies+to+Arquillian+test&amp;url=http://localhost:40002015/06/07/adding-maven-dependencies-to-arquillian-test/">Twitter</a>
                    <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:40002015/06/07/adding-maven-dependencies-to-arquillian-test/">Facebook</a>
                </div><!-- .share-post -->
            </footer>
            <div class="author-box">
                <div class="author-avatar"><img src="/assets/images/authorimage.jpg" alt="Cassio Molin's Picture"
                        class="avatar"></div>
                <div class="author-details">
                    <h2 class="author-title">About Cassio Molin</h2>
                    <p class="author-description">Cassio is a software engineer living, working and drinking in Ireland.<br>
Has been using Java for many years and still loves it.
</p>
                </div>
            </div>
            

        </article>
        
        <section class="read-next inner">
            <h2 class="read-next-title">Read Next</h2>
            
            <article class="post">
                <header class="post-header">
                    <div class="post-meta">
                        <time class="published" datetime="November 6, 2014">November 6, 2014</time>
                    </div>
                    <h3 class="post-title"><a href="/2014/11/06/token-based-authentication-with-jaxrs-20/">Token-based authentication with JAX-RS 2.0</a></h3>
                    <p class="post-tags">
                        
                        
                        
                        <a href='/tag/authentication/'>authentication</a>
                        
                        
                        
                        <a href='/tag/java/'>java</a>
                        
                        
                        
                        <a href='/tag/jax-rs/'>jax-rs</a>
                        
                        
                        
                    </p>
                </header>
                
                
            </article>
            
            
            <article class="post">
                <header class="post-header">
                    <div class="post-meta">
                        <time class="published" datetime="February 11, 2016">February 11, 2016</time>
                    </div>
                    <h3 class="post-title"><a href="/2016/02/11/give-better-names-to-your-dtos/">Give better names to your DTOs</a></h3>
                    <p class="post-tags">
                        
                        
                        
                        <a href='/tag/java/'>java</a>
                        
                        
                        
                        <a href='/tag/dto/'>dto</a>
                        
                        
                        
                    </p>
                </header>
                
                
            </article>
            
        </section><!-- .read-next -->
    </main><!-- .site-main -->
</div><!-- .site-content -->

        

        

        <footer id="colophon" class="site-footer outer">
            <div class="site-footer-inside">
                <p class="social-links">
    
    
    
    <a href="https://github.com/cassiomolin" target="_blank">
        <span class="fa-github fa" aria-hidden="true"></span>
        <span class="screen-reader-text">GitHub</span>
    </a>
    
    
    
    
    
    
    
    <a href="https://www.linkedin.com/in/cassiomolin" target="_blank">
        <span class="fa-linkedin fa" aria-hidden="true"></span>
        <span class="screen-reader-text">Linkedin</span>
    </a>
    
    
    
    <a href="https://www.stackoverflow.com/u/1426227" target="_blank">
        <span class="fa-stack-overflow fa" aria-hidden="true"></span>
        <span class="screen-reader-text">ProductHunt</span>
    </a>
    
</p>
                <p class="site-info">
                    <a href="/">cassiomolin</a> &copy; 2019. Written with ♥ in Ireland. <br />
                    Powered by <a target="_blank" href="https://jekyllrb.com/">Jekyll</a>.
                </p>
                <p class="back-to-top">
                    <a id="top-button" class="top-button" href="#page">
                        <span class="icon-arrow-up" aria-hidden="true"></span>
                        <span class="screen-reader-text">Back to top</span>
                    </a>
                </p>
            </div><!-- .site-footer-inside -->
        </footer><!-- .site-footer -->
    </div><!-- .site -->
    <div id="site-overlay" class="site-overlay"></div>
    <aside id="sidebar" class="sidebar">
	<div class="sidebar-scrollable">
		<div class="sidebar-inside">
			<button id="sidebar-hide" class="sidebar-toggle"><span class="screen-reader-text">Close Sidebar</span><span
				    aria-hidden="true" class="icon-close"></span></button>
			<nav id="sidebar-navigation" class="widget site-navigation">
				<h2 class="widget-title">Explore Site</h2>
				<ul class="menu">
					
						<li class="menu-item"><a href="/about/">About</a></li>
					
						<li class="menu-item"><a href="/contact/">Contact Me</a></li>
					
				</ul>
			</nav>
			
<section class="widget widget-text">
    <h2 class="widget-title">About cassiomolin</h2>
    <p>A collection of programming insights by Cassio Molin.</p>
</section>


<section class="widget widget-recent-posts">
    <h2 class="widget-title">Recent Articles</h2>
    <ul>
        
        <li>
            <div class="post-header">
                <div class="post-meta">
                    <time class="published" datetime="??">July 23, 2018</time>
                </div>
                <div class="post-title">
                    <a href="http://localhost:4000/2018/07/23/comparing-json-documents-in-java/">Comparing JSON documents in Java</a>
                </div>
            </div>
            
            <a class="post-thumbnail" href="/2018/07/23/comparing-json-documents-in-java/">
                <img src="http://localhost:4000/assets/images/posts/rob-bates-701730-unsplash.jpg"
                    alt="Comparing JSON documents in Java">
            </a>
            
        </li>
        
        <li>
            <div class="post-header">
                <div class="post-meta">
                    <time class="published" datetime="??">December 12, 2017</time>
                </div>
                <div class="post-title">
                    <a href="http://localhost:4000/2017/12/12/maven-cheat-sheet/">Maven cheat sheet</a>
                </div>
            </div>
            
            <a class="post-thumbnail" href="/2017/12/12/maven-cheat-sheet/">
                <img src="http://localhost:4000/assets/images/posts/james-traf-1152925-unsplash.jpg"
                    alt="Maven cheat sheet">
            </a>
            
        </li>
        
        <li>
            <div class="post-header">
                <div class="post-meta">
                    <time class="published" datetime="??">November 22, 2017</time>
                </div>
                <div class="post-title">
                    <a href="http://localhost:4000/2017/11/22/stop-using-the-rfc-2616/">Stop using the RFC 2616</a>
                </div>
            </div>
            
            
        </li>
        
    </ul>
</section>

<!-- Create a sorted array of tags -->
 
<section class="widget widget-tagcloud">
    <h2 class="widget-title">Tags</h2>
    <div class="tagcloud">
        
        <a href='/tag/arquillian/'>arquillian</a>
        
        <a href='/tag/authentication/'>authentication</a>
        
        <a href='/tag/bean-validation/'>bean-validation</a>
        
        <a href='/tag/cdi/'>cdi</a>
        
        <a href='/tag/dto/'>dto</a>
        
        <a href='/tag/ejb/'>ejb</a>
        
        <a href='/tag/gson/'>gson</a>
        
        <a href='/tag/guava/'>guava</a>
        
        <a href='/tag/http/'>http</a>
        
        <a href='/tag/jackson/'>jackson</a>
        
        <a href='/tag/java/'>java</a>
        
        <a href='/tag/jax-rs/'>jax-rs</a>
        
        <a href='/tag/jersey/'>jersey</a>
        
        <a href='/tag/json/'>json</a>
        
        <a href='/tag/maven/'>maven</a>
        
        <a href='/tag/rest/'>rest</a>
        
        <a href='/tag/servlet/'>servlet</a>
        
        <a href='/tag/spring-boot/'>spring-boot</a>
        
        <a href='/tag/test/'>test</a>
        
    </div>
</section>


		</div><!-- .sidebar-inside -->
	</div><!-- .sidebar-scrollable -->
</aside><!-- .sidebar -->
    
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-69796629-3"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-69796629-3', { 'anonymize_ip': true });
  </script>

    <!-- Javascript Assets -->
    <script src="/assets/js/jquery-3.3.1.min.js"></script>
    <script src="/assets/js/plugins.js"></script>
    <script src="/assets/js/custom.js"></script>

</body>

</html>